

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="https://q.qlogo.cn/headimg_dl?dst_uin=819429207&amp;spec=640&amp;img_type=jpg">
  <link rel="icon" href="https://q.qlogo.cn/headimg_dl?dst_uin=819429207&amp;spec=640&amp;img_type=jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="微服务01 2024 10 1 更新 微服务事务的场景 cap-   ca   cp原则      Seata的模式   总结-微服务01 远程调用 RestTemplate-&gt;nacos-&gt;OpenFeign-&gt; 微服务02  GetWay网关-&gt;nacos进阶 微服务3 微服务保护-&gt;Sentinel-&gt;微服务事务 微服务了解1.微服务和单体服务区别单体架构">
<meta property="og:type" content="article">
<meta property="og:title" content="微服务Spring Cloude">
<meta property="og:url" content="http://example.com/2024/09/20/%E5%BE%AE%E6%9C%8D%E5%8A%A101/index.html">
<meta property="og:site_name" content="逆向狗">
<meta property="og:description" content="微服务01 2024 10 1 更新 微服务事务的场景 cap-   ca   cp原则      Seata的模式   总结-微服务01 远程调用 RestTemplate-&gt;nacos-&gt;OpenFeign-&gt; 微服务02  GetWay网关-&gt;nacos进阶 微服务3 微服务保护-&gt;Sentinel-&gt;微服务事务 微服务了解1.微服务和单体服务区别单体架构">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/da4945c334b905363d17af697d049ab0.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/44368b18c4a6590fc1de4c06feb8ffd0.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/a901f2f7901587696846615aaf0ef1eb.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/894106143910c2cbb7708074f9256b47.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/8ef363e77fbcac43b74e31bea4ea42e4.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/e7c61f69d70066c2f618e3b78b5ab0ea.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/354729fe5f6622042462ec267dae5a42.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/38aa2eb16283ccac08085d7a12d3a698.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/905b852bbe9e52b6c85f8ef4b220e33e.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/2382bee1bde9f36e4701b2bf0c9986dd.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/4c2ae85d3e2a4b4c39a8d840d28d3016.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/5287cf7a27091d5968a3b9b76965f182.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/152860dce440d1d9e73f5ef0c6818808.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/1ab667da96d404a3693f73e8f3e61dbd.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/95c8c6bd4312301e08eb279ca19c6f72.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/b00650836cc74d97154f0c19e0885e3b.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/cc0c30e1121009042204d4d6e490b1a0.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/8199919e0d3bd8725cdbd299ff19a5db.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/0a7daefd898024466d28967eea99da8c.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/e73d3e068484e2e31915ba7653f1003c.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/e73d3e068484e2e31915ba7653f1003c.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/0ed643292f8dcdbb4ff4d6e96ce00153.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/8241cb4042ea1e687948cd9b6c752e4b.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/d0853161a442680c814a26edfd25d44b.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/2f85cd781db72ba5994a9b7341f64c2f.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/76f1f3f63bb3b8d05dc723f7f12117a2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/670ebe6e23b9c09af17b4f1e53a3f249.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/814cd85a1c02b2c0d6fcb82731791e49.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/33c9a08d518a78765fcfda164468e9ed.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/e602e00dfea1425d97903200ab20744d.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/906530d2a10b4728e2e15ef674b795ab.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/eba4edc2810d7f0f0c3a6af446baf9c6.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/a10173c12662023f3b425ef0fa1cf022.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/d7f0640d795ce3dfac74f1cd2921f308.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/8462748af036d85d5789334d705224cc.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/c715d9286b13c80bef8c74b434f3eabc.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/88ec0600e28b2a9d0ca37d52cefc3d1f.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/1f41d6a93c5a68ed3df317daf479a836.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/7fe049b96c1496d2914d63fb65f8a192.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/a4e216499c59db0b068a2d2adcfb6344.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/b8745f34d893608b923694068caa317a.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/d9d50e713326b10f6cbc455e35ac9982.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/21423572850708f447c70112b71b58fe.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/4715d2573fb1cca2b0ad7ffd60d4cf77.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/036abaa6e3c3efa4258a1ebb6a9a3f74.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/5e22d64051c12080b52e137b3f2df8d1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/c302ab029433076c8f27b8b744e77da4.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/788621b778db5d0475a1459c7f47f2ef.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/34f7f37b9b9c8cd0cf8312e5f077eeb4.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/c7b8cd24915878d194e94777d1dc125c.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/d9ab61eb239f97e8060fb49f7e71f0e1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/bb27fd15744a4ce0dbbebcec3c82fded.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/7bd5b3ef60ef4f21a05d38e55b3c9c97.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/247218cd325db9d0990af715191c506f.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/0fccbe790ea662f50e4dc78e637dfeb9.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/eb2704aaff009260682661686d43a863.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/3834ba9c13d5c8765637fa028b2d2540.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/1be7a5e7b5ff63918edfb6a98a4df1e8.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/21dbf7eb235492bb336c2ee5a9b1d495.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/9283c00f8a1b26caba5a8ea4a7d47102.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/5adedac41a06aa9d5d23e1c048f9aefc.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/aa552325c073f6eb535f3dbda6adf3c2.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/f3ec0f2747e58af51ff00c89fad2f637.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/dd6ad74e5a523414c5fa94e71ce26b44.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/513f93a0c1b54d9cf48340131857d35b.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/8bea4b790cd4908a3b2c157b54a82324.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/dd258ef0eff928db8ad60a51fa901e21.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/96bf2d1721a6ad24b4c4c57a0420950e.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/61c54a305d589adf29b99e9e783df0d8_720.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/56ceaa1b237096af7d548dff22f64079.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/46c47701adaebf8ecdf3bedffcebfcd2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/b8be56aab96f78ab8cc6280a940b9654.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/c41d54b8f48ef781a5719d594365b351.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/7186f713c807cd96f4f0736cfdf33eb9.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/image-20241001165833626.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/image-20241001165844052.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/image-20241001165924978.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/image-20241001165947190.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/image-20241001170026148.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/image-20241001170311395.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/image-20241001170352060.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/0c45f4302dfe6ec401b7166531e8d0ee.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/13bdfa580099aaad3e6b5b6b3a658b23.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/954d7d66dc6aede16d41e72775d344aa_720.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/47128070412f9199c201de643d226dfe.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/4e467740c6cae0760dfeeec1f185a409.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/969b0797c9e9111080031504307f449a.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/5a81cb44028665de51944504b72b9d05.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/661baa4e424fa939c19202b5b66381c0.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/55c86dd3399de2a54a2a7529aba97425.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/709e85023e48ff24e13992252e2462ce.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/7db161ff42213ab817db33e83bb099e7.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/eec304cd22421ef584ef0d4365467799_720.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/649c531678978500ca68bd26a8db0c6a_720.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/15c2cee13194b25bd165d5980011e9ed.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/88b2c6ae733ee58267bce34f201a1f25.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/05e2129219408c89e3e555605e1ff6cd.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/0c8c093537f83c8d013dc24d35de1ca5.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/e527cdc2f3f935ead60411649086b841.png">
<meta property="article:published_time" content="2024-09-20T12:22:30.000Z">
<meta property="article:modified_time" content="2024-10-01T09:05:28.704Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Xlan-cell/tupian/master/1.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>微服务Spring Cloude - 逆向狗</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>逆向狗</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://s1.locimg.com/2024/09/06/63bc048e8a257.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="微服务Spring Cloude"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        John Doe
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-09-20 20:22" pubdate>
          2024年9月20日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6.4k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          54 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">微服务Spring Cloude</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="微服务01"><a href="#微服务01" class="headerlink" title="微服务01"></a>微服务01</h1><blockquote>
<p>2024 10 1 更新 微服务事务的场景 cap-   ca   cp原则      Seata的模式</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/1.png" srcset="/img/loading.gif" lazyload alt="1"></p>
<p>总结-<br>微服务01</p>
<p>远程调用 RestTemplate-&gt;nacos-&gt;OpenFeign-&gt;</p>
<p>微服务02  GetWay网关-&gt;nacos进阶</p>
<p>微服务3 微服务保护-&gt;Sentinel-&gt;微服务事务</p>
<h4 id="微服务了解"><a href="#微服务了解" class="headerlink" title="微服务了解"></a>微服务了解</h4><h6 id="1-微服务和单体服务区别"><a href="#1-微服务和单体服务区别" class="headerlink" title="1.微服务和单体服务区别"></a>1.微服务和单体服务区别</h6><p>单体架构-项目的文件都在同一个工程中开发-项目部署简单<br>但是<br>团队协作不好分工<br>系统发布效率低<br>系统可用性差-无分布式效果-导致功能之间相互影响大</p>
<hr>
<p>微服务原则<br>单一职责-一个微服务辅助一部分业务功能-核心数据不依赖其他模块<br>团队自治-每个微服务都有独立的开发测试人员<br>服务自治-每个微服务独立部署</p>
<hr>
<ul>
<li>团队协作成本高？</li>
<li>系统发布效率低？</li>
<li>系统可用性差？</li>
</ul>
<h6 id="2-SpringCloude"><a href="#2-SpringCloude" class="headerlink" title="2.SpringCloude"></a>2.SpringCloude</h6><p>SpringCloud框架是Java领域的微服务组件的集合。</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/da4945c334b905363d17af697d049ab0.png" srcset="/img/loading.gif" lazyload alt="da4945c334b905363d17af697d049ab0"></p>
<p>SpringCloud依托于SpringBoot的自动装配能力，大大降低了其项目搭建、组件使用的成本</p>
<p>Spring Cloud 是在 Spring Boot 之上构建的一组工具和框架，主要用于解决分布式系统中的常见问题，如服务注册与发现、负载均衡、配置管理、断路器等。它提供了一整套微服务架构下的解决方案。</p>
<h6 id="3-微服务拆分原则"><a href="#3-微服务拆分原则" class="headerlink" title="3.微服务拆分原则"></a>3.微服务拆分原则</h6><ul>
<li><p>什么时候拆？</p>
</li>
<li><p>如何拆？<br>大多数小型项目来说，一般是先采用单体架构，随着用户规模扩大、业务复杂后再逐渐拆分为微服务架构。</p>
</li>
<li><p>高内聚：每个微服务的职责要尽量单一，包含的业务相互关联度高、完整度高。</p>
</li>
<li><p>低耦合：每个微服务的功能要相对独立，尽量减少对其它微服务的依赖，或者依赖接口的稳定性要强。</p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/44368b18c4a6590fc1de4c06feb8ffd0.png" srcset="/img/loading.gif" lazyload alt="44368b18c4a6590fc1de4c06feb8ffd0"></p>
<ul>
<li>纵向拆分<br>就是按照项目的功能模块来拆分。<br>例如黑马商城中，就有用户管理功能、订单管理功能、。按照功能模块将他们拆分为一个个服务，就属于纵向拆分。这种拆分模式可以尽可能提高服务的内聚性。</li>
<li>横向拆分<br>各个功能模块之间有没有公共的业务部分，如果有将其抽取出来作为通用服务。<br>例如用户登录是需要发送消息通知，记录风控数据，下单时也要发送短信，记录风控数据。因此消息发送、风控数据记录就是通用的业务功能，因此可以将他们分别抽取为公共服务：消息中心服务、风控管理服务。这样可以提高业务的复用性，避免重复开发。同时通用业务一般接口稳定性较强，也不会使服务之间过分耦合。</li>
</ul>
<h6 id="4-微服务拆分"><a href="#4-微服务拆分" class="headerlink" title="4.微服务拆分"></a>4.微服务拆分</h6><p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/a901f2f7901587696846615aaf0ef1eb.png" srcset="/img/loading.gif" lazyload alt="a901f2f7901587696846615aaf0ef1eb"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/894106143910c2cbb7708074f9256b47.png" srcset="/img/loading.gif" lazyload alt="894106143910c2cbb7708074f9256b47"></p>
<h4 id="springcloude技术栈"><a href="#springcloude技术栈" class="headerlink" title="springcloude技术栈"></a>springcloude技术栈</h4><h4 id="1-远程调用"><a href="#1-远程调用" class="headerlink" title="1.远程调用"></a>1.远程调用</h4><h6 id="0-场景"><a href="#0-场景" class="headerlink" title="0.场景"></a>0.场景</h6><p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/8ef363e77fbcac43b74e31bea4ea42e4.png" srcset="/img/loading.gif" lazyload alt="8ef363e77fbcac43b74e31bea4ea42e4"></p>
<p>itmservice.chaxun(id);-&gt;改为远程调用</p>
<h6 id="1-RestTemplate"><a href="#1-RestTemplate" class="headerlink" title="1.RestTemplate"></a>1.RestTemplate</h6><p>同步客户端执行HTTP请求</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/e7c61f69d70066c2f618e3b78b5ab0ea.png" srcset="/img/loading.gif" lazyload alt="e7c61f69d70066c2f618e3b78b5ab0ea"></p>
<p>使用</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/354729fe5f6622042462ec267dae5a42.png" srcset="/img/loading.gif" lazyload alt="354729fe5f6622042462ec267dae5a42"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/38aa2eb16283ccac08085d7a12d3a698.png" srcset="/img/loading.gif" lazyload alt="38aa2eb16283ccac08085d7a12d3a698"></p>
<p>可以看到，利用RestTemplate发送http请求与前端ajax发送请求非常相似，都包含四部分信息：</p>
<ul>
<li><p>① 请求方式</p>
</li>
<li><p>② 请求路径</p>
</li>
<li><p>③ 请求参数<br>返回值类型</p>
</li>
</ul>
<p>缺点<br><strong>负载均衡麻烦-无法指定请求路径</strong><br><strong>-我们就需要一个注册中心-帮我们收集实例-当访问对应就给与一个</strong></p>
<hr>
<h4 id="Nacos-注册中心"><a href="#Nacos-注册中心" class="headerlink" title="Nacos-注册中心"></a>Nacos-注册中心</h4><h6 id="0-了解nacos"><a href="#0-了解nacos" class="headerlink" title="0.了解nacos"></a>0.了解nacos</h6><p><strong>Nacos</strong> 是阿里巴巴开源的一款用于动态服务发现、配置管理和服务管理的工具，主要用于微服务架构中的服务治理。它的核心目标是简化分布式系统中的服务注册、服务发现和配置管理，并提供一站式解决方案。</p>
<p>Nacos 是一个面向微服务架构的服务治理平台，它的主要作用包括：</p>
<ul>
<li><strong>动态服务注册与发现</strong>，帮助微服务自动化发现其他服务。</li>
<li><strong>配置管理</strong>，提供了强大的配置存储、版本控制、动态刷新功能，提升了微服务架构下的配置灵活性。</li>
<li><strong>健康检查</strong>，保障服务的高可用性和故障隔离能力。</li>
</ul>
<h5 id="1-注册中心入门"><a href="#1-注册中心入门" class="headerlink" title="1.注册中心入门"></a>1.注册中心入门</h5><ul>
<li><p>服务提供者：提供接口供其它微服务访问，比如item-service</p>
</li>
<li><p>服务消费者：调用其它微服务提供的接口，比如cart-service</p>
</li>
</ul>
<p>为了管理这些服务·务消费者三者间关系如下：</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/905b852bbe9e52b6c85f8ef4b220e33e.png" srcset="/img/loading.gif" lazyload alt="905b852bbe9e52b6c85f8ef4b220e33e"></p>
<h6 id="2-注册中心配置-Docker"><a href="#2-注册中心配置-Docker" class="headerlink" title="2.注册中心配置-Docker"></a>2.注册中心配置-Docker</h6><p>1.导入nacos表</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/2382bee1bde9f36e4701b2bf0c9986dd.png" srcset="/img/loading.gif" lazyload alt="2382bee1bde9f36e4701b2bf0c9986dd"></p>
<p>2.修改配置文件</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/4c2ae85d3e2a4b4c39a8d840d28d3016.png" srcset="/img/loading.gif" lazyload alt="4c2ae85d3e2a4b4c39a8d840d28d3016"></p>
<p>3.<img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/5287cf7a27091d5968a3b9b76965f182.png" srcset="/img/loading.gif" lazyload alt="5287cf7a27091d5968a3b9b76965f182"></p>
<h6 id="2-注册中心配置-spring-cloude"><a href="#2-注册中心配置-spring-cloude" class="headerlink" title="2.注册中心配置-spring cloude"></a>2.注册中心配置-spring cloude</h6><p>服务注册</p>
<p>1.引入依赖<br>2.配置nacos地址<br>3.重启</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/152860dce440d1d9e73f5ef0c6818808.png" srcset="/img/loading.gif" lazyload alt="152860dce440d1d9e73f5ef0c6818808"></p>
<p>在nacos的服务列表中即可看到</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/1ab667da96d404a3693f73e8f3e61dbd.png" srcset="/img/loading.gif" lazyload alt="1ab667da96d404a3693f73e8f3e61dbd"></p>
<p>服务发现<br>1.引入依赖</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/95c8c6bd4312301e08eb279ca19c6f72.png" srcset="/img/loading.gif" lazyload alt="95c8c6bd4312301e08eb279ca19c6f72"></p>
<p>2.配置nacos</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/b00650836cc74d97154f0c19e0885e3b.png" srcset="/img/loading.gif" lazyload alt="b00650836cc74d97154f0c19e0885e3b"></p>
<p>3.发现调用服务<br>负载均衡调用服务选择<br>随机-轮训-ip的hash-最少访问</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/cc0c30e1121009042204d4d6e490b1a0.png" srcset="/img/loading.gif" lazyload alt="cc0c30e1121009042204d4d6e490b1a0"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/8199919e0d3bd8725cdbd299ff19a5db.png" srcset="/img/loading.gif" lazyload alt="8199919e0d3bd8725cdbd299ff19a5db"></p>
<p>但是代码还是非常嘈杂以及难看-</p>
<h4 id="OpenFeign-远程调用"><a href="#OpenFeign-远程调用" class="headerlink" title="OpenFeign-远程调用"></a>OpenFeign-远程调用</h4><p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/0a7daefd898024466d28967eea99da8c.png" srcset="/img/loading.gif" lazyload alt="0a7daefd898024466d28967eea99da8c"></p>
<h6 id="1-快速入门案例"><a href="#1-快速入门案例" class="headerlink" title="1.快速入门案例"></a>1.快速入门案例</h6><p>1.导入案例</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/e73d3e068484e2e31915ba7653f1003c.png" srcset="/img/loading.gif" lazyload alt="e73d3e068484e2e31915ba7653f1003c"></p>
<p>2.启动注解</p>
<p>快速入门案例 1.导入案例</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/e73d3e068484e2e31915ba7653f1003c.png" srcset="/img/loading.gif" lazyload alt="img"><br>2.启动注解</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/0ed643292f8dcdbb4ff4d6e96ce00153.png" srcset="/img/loading.gif" lazyload alt="img"><br>3.代码编写</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/8241cb4042ea1e687948cd9b6c752e4b.png" srcset="/img/loading.gif" lazyload alt="8241cb4042ea1e687948cd9b6c752e4b"></p>
<p>private final ItemClient itemclient;<br>List&lt;&gt;items&#x3D;itemclient.query();</p>
<p>如上feign帮我们进行了 <strong>服务拉取 负载均衡 -请发送的所有工作</strong></p>
<h6 id="2-OpenFeign连接池"><a href="#2-OpenFeign连接池" class="headerlink" title="2.OpenFeign连接池"></a>2.OpenFeign连接池</h6><p>我们发起请求的话-需要建立连接-再销毁-但连接池可以减少这个过程产生的消耗<br>使用ok-http连接池<br>1.导入依赖<br>2.配置启用</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/d0853161a442680c814a26edfd25d44b.png" srcset="/img/loading.gif" lazyload alt="d0853161a442680c814a26edfd25d44b"></p>
<p>OkHttp连接池的操作如下：</p>
<pre><code class="hljs">连接的创建和管理: OkHttp连接池会在应用程序启动时创建一组HTTP连接，并在需要时将其保持在连接池中。这些连接可以被多个线程共享和重用，而不是每次请求都重新创建连接。

连接的重用: 当一个线程需要执行一个HTTP请求时，它可以从连接池中获取一个可用的连接，而不必等待新连接的创建。如果连接池中没有可用的连接，线程可能会被阻塞，直到有连接可用为止。

连接的释放: 当一个线程完成了对某个HTTP服务的请求，它会将连接放回连接池，而不是关闭连接。这样可以避免频繁地打开和关闭连接，提高了连接的重用率。
</code></pre>
<p>OkHttp连接池可以加快效率的原因包括：</p>
<pre><code class="hljs">减少连接的创建和销毁开销：通过重用连接，可以避免频繁地创建和销毁连接，从而减少了系统资源的消耗和网络延迟。

提高并发性能：连接池可以确保连接的有效重用，从而使多个线程能够并发地共享同一个连接，提高了系统的并发处理能力。

降低网络延迟：通过重用连接和减少连接的创建次数，可以减少网络请求的等待时间，从而降低了网络延迟，提高了系统的响应速度。
</code></pre>
<p>总的来说，OkHttp连接池的有效管理和重用HTTP连接可以显著提高应用程序的性能和效率，特别是在需要频繁进行HTTP通信的场景下。</p>
<p>这里的请求-是固定的 故此可以保存</p>
<h6 id="3-api抽取"><a href="#3-api抽取" class="headerlink" title="3.api抽取"></a>3.api抽取</h6><p>方案1 结构层次低-耦合度高<br>方案2 结构层次复杂-哦合度低<img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/2f85cd781db72ba5994a9b7341f64c2f.png" srcset="/img/loading.gif" lazyload alt="2f85cd781db72ba5994a9b7341f64c2f"></p>
<h6 id="包扫描问题"><a href="#包扫描问题" class="headerlink" title="包扫描问题"></a>包扫描问题</h6><p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/76f1f3f63bb3b8d05dc723f7f12117a2.png" srcset="/img/loading.gif" lazyload alt="76f1f3f63bb3b8d05dc723f7f12117a2"></p>
<p>也是注册为bean-但我忘记常量注入了</p>
<h6 id="fegin日志配置"><a href="#fegin日志配置" class="headerlink" title="fegin日志配置"></a>fegin日志配置</h6><p>![2e098ace474e1339c04dd1aa450c100b](G:\360MoveData\Users\nixg\Documents\Tencent Files\2760045743\nt_qq\nt_data\Pic\2024-05\Ori\2e098ace474e1339c04dd1aa450c100b.png)</p>
<p>修改日志</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/670ebe6e23b9c09af17b4f1e53a3f249.png" srcset="/img/loading.gif" lazyload alt="670ebe6e23b9c09af17b4f1e53a3f249"></p>
<h1 id="微服务02"><a href="#微服务02" class="headerlink" title="微服务02"></a>微服务02</h1><p>网关过滤器-全局-和指定-&gt;网关登录鉴权-&gt;</p>
<p>微服务到微服务-&gt;Feing拦截器</p>
<p>naocs-&gt;配置共享 -配置热更新-动态路由</p>
<h2 id="Getway网关"><a href="#Getway网关" class="headerlink" title="Getway网关"></a>Getway网关</h2><h6 id="1-网关了解"><a href="#1-网关了解" class="headerlink" title="1.网关了解"></a>1.网关了解</h6><p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/814cd85a1c02b2c0d6fcb82731791e49.png" srcset="/img/loading.gif" lazyload alt="814cd85a1c02b2c0d6fcb82731791e49"></p>
<h6 id="2-SpringGetWay网关"><a href="#2-SpringGetWay网关" class="headerlink" title="2.SpringGetWay网关"></a>2.SpringGetWay网关</h6><p>1.创建网关微服务<br>2.引入依赖<br>3.编写启动类<br>4.配置网关路由</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/33c9a08d518a78765fcfda164468e9ed.png" srcset="/img/loading.gif" lazyload alt="33c9a08d518a78765fcfda164468e9ed"></p>
<p>配置</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/e602e00dfea1425d97903200ab20744d.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>规则合集</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/906530d2a10b4728e2e15ef674b795ab.png" srcset="/img/loading.gif" lazyload alt="906530d2a10b4728e2e15ef674b795ab"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/eba4edc2810d7f0f0c3a6af446baf9c6.png" srcset="/img/loading.gif" lazyload alt="eba4edc2810d7f0f0c3a6af446baf9c6"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/a10173c12662023f3b425ef0fa1cf022.png" srcset="/img/loading.gif" lazyload alt="a10173c12662023f3b425ef0fa1cf022"></p>
<h6 id="3-网关登录鉴权"><a href="#3-网关登录鉴权" class="headerlink" title="3.网关登录鉴权"></a>3.网关登录鉴权</h6><p>登录思路-很多敏感思路都需要鉴权-我们又不可能重复写鉴权代码<br>故此网关思路即可<br>既然网关是所有微服务的入口，一切请求都需要先经过网关。我们完全可以把登录校验的工作放到网关去做，这样之前说的问题就解决了：</p>
<ul>
<li>只需要在网关和用户服务保存秘钥</li>
<li>只需要在网关开发登录校验功能</li>
<li></li>
</ul>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/d7f0640d795ce3dfac74f1cd2921f308.png" srcset="/img/loading.gif" lazyload alt="d7f0640d795ce3dfac74f1cd2921f308"></p>
<p>1.网关传递用户信息-加信息头<br>2.服务直接传递信息-&gt;加信息头</p>
<h3 id="网关过滤器"><a href="#网关过滤器" class="headerlink" title="网关过滤器"></a>网关过滤器</h3><h6 id="1-过滤器了解"><a href="#1-过滤器了解" class="headerlink" title="1.过滤器了解"></a>1.过滤器了解</h6><p>网关的请求转发-由于getway实现<br>具体实现</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/8462748af036d85d5789334d705224cc.png" srcset="/img/loading.gif" lazyload alt="8462748af036d85d5789334d705224cc"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/c715d9286b13c80bef8c74b434f3eabc.png" srcset="/img/loading.gif" lazyload alt="c715d9286b13c80bef8c74b434f3eabc"></p>
<p>定义一个网关过滤器<br>进行登录逻辑判断-&gt;再Nett….之前</p>
<p>网关过滤器<br>1.路由过滤器 GatewayFilter指定规则<br>2.全局过滤器 GlobalFilter 全局规则</p>
<p>过滤器链之外还有一种过滤器，HttpHeadersFilter，用来处理传递到下游微服务的请求头。</p>
<p>FilteringWebHandeler处理会将全局-装饰为路由-放到同一过滤器链中<br>依次执行</p>
<p>spring cloude<br>指定的 路由过滤器<br><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/3.1.7/reference/html/#gatewayfilter-factories">https://docs.spring.io/spring-cloud-gateway/docs/3.1.7/reference/html/#gatewayfilter-factories</a></p>
<h6 id="2-内置过滤器"><a href="#2-内置过滤器" class="headerlink" title="2.内置过滤器"></a>2.内置过滤器</h6><p>gateway内置的GatewayFilter过滤器使用起来非常简单，无需编码，只要在yaml文件中简单配置即可。而且其作用范围也很灵活，配置在哪个Route下，就作用于哪个Route.</p>
<p>AddRequestHeaderGatewayFilterFacotry<br>使用配置</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/88ec0600e28b2a9d0ca37d52cefc3d1f.png" srcset="/img/loading.gif" lazyload alt="88ec0600e28b2a9d0ca37d52cefc3d1f"></p>
<h6 id="3-网关路由器-GatewayFilter"><a href="#3-网关路由器-GatewayFilter" class="headerlink" title="3.网关路由器 GatewayFilter"></a>3.网关路由器 GatewayFilter</h6><p>自定义GatewayFilter不是直接实现GatewayFilter，而是实现AbstractGatewayFilterFactory</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/1f41d6a93c5a68ed3df317daf479a836.png" srcset="/img/loading.gif" lazyload alt="1f41d6a93c5a68ed3df317daf479a836"></p>
<p>该类的名称一定要以GatewayFilterFactory为后缀！</p>
<p>spring:<br>  cloud:<br>    gateway:<br>      default-filters:<br>            - PrintAny # 此处直接以自定义的GatewayFilterFactory类名称前缀类声明过滤器</p>
<h6 id="4-动态配置参数-GatewayFilter"><a href="#4-动态配置参数-GatewayFilter" class="headerlink" title="4.动态配置参数 GatewayFilter"></a>4.动态配置参数 GatewayFilter</h6><p>过滤器动态配置参数</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/7fe049b96c1496d2914d63fb65f8a192.png" srcset="/img/loading.gif" lazyload alt="7fe049b96c1496d2914d63fb65f8a192"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/a4e216499c59db0b068a2d2adcfb6344.png" srcset="/img/loading.gif" lazyload alt="a4e216499c59db0b068a2d2adcfb6344"></p>
<h6 id="5-全局过滤器-GlobalFilter"><a href="#5-全局过滤器-GlobalFilter" class="headerlink" title="5.全局过滤器 GlobalFilter"></a>5.全局过滤器 GlobalFilter</h6><p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/b8745f34d893608b923694068caa317a.png" srcset="/img/loading.gif" lazyload alt="b8745f34d893608b923694068caa317a"></p>
<h4 id="案例-网关登录鉴权"><a href="#案例-网关登录鉴权" class="headerlink" title="案例 -网关登录鉴权"></a>案例 -网关登录鉴权</h4><p>登录效验编写-<br>思路<br>全局过滤器中-对jwt进行解析-同时解析完毕将信息构造请求头中-以待微服务拿取-<br>如果解析失败-就直接返回</p>
<h6 id="1-网关拦截-转user-传递到请求头中"><a href="#1-网关拦截-转user-传递到请求头中" class="headerlink" title="1.网关拦截-转user-&gt;传递到请求头中"></a>1.网关拦截-转user-&gt;传递到请求头中</h6><p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/d9d50e713326b10f6cbc455e35ac9982.png" srcset="/img/loading.gif" lazyload alt="d9d50e713326b10f6cbc455e35ac9982"></p>
<h6 id="2-网关到微服务"><a href="#2-网关到微服务" class="headerlink" title="2.网关到微服务"></a>2.网关到微服务</h6><p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/21423572850708f447c70112b71b58fe.png" srcset="/img/loading.gif" lazyload alt="21423572850708f447c70112b71b58fe"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/4715d2573fb1cca2b0ad7ffd60d4cf77.png" srcset="/img/loading.gif" lazyload alt="4715d2573fb1cca2b0ad7ffd60d4cf77"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/036abaa6e3c3efa4258a1ebb6a9a3f74.png" srcset="/img/loading.gif" lazyload alt="036abaa6e3c3efa4258a1ebb6a9a3f74"></p>
<h6 id="3-微服务到微服务的传递"><a href="#3-微服务到微服务的传递" class="headerlink" title="3.微服务到微服务的传递"></a>3.微服务到微服务的传递</h6><p>OpenFeign传递<br>OpenFeign-提供了一个拦截器</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/5e22d64051c12080b52e137b3f2df8d1.png" srcset="/img/loading.gif" lazyload alt="5e22d64051c12080b52e137b3f2df8d1"></p>
<h3 id="nacos配置管理"><a href="#nacos配置管理" class="headerlink" title="nacos配置管理"></a>nacos配置管理</h3><p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/c302ab029433076c8f27b8b744e77da4.png" srcset="/img/loading.gif" lazyload alt="c302ab029433076c8f27b8b744e77da4"></p>
<p>解决配置写死-以及重复配置等问题</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/788621b778db5d0475a1459c7f47f2ef.png" srcset="/img/loading.gif" lazyload alt="788621b778db5d0475a1459c7f47f2ef"></p>
<h6 id="1-配置共享"><a href="#1-配置共享" class="headerlink" title="1.配置共享"></a>1.配置共享</h6><p>1.naocs<strong>添加配置</strong></p>
<p>password : ${hm.db.password:}</p>
<ul>
<li>数据库database：可以通过${hm.db.database:test}来设定，默认值test</li>
</ul>
<p>2.微服务拉取配置</p>
<p>将共享配置与本地的application.yaml配置合并</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/34f7f37b9b9c8cd0cf8312e5f077eeb4.png" srcset="/img/loading.gif" lazyload alt="34f7f37b9b9c8cd0cf8312e5f077eeb4"></p>
<p>依赖</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/c7b8cd24915878d194e94777d1dc125c.png" srcset="/img/loading.gif" lazyload alt="c7b8cd24915878d194e94777d1dc125c"></p>
<p>bootstart.yaml</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/d9ab61eb239f97e8060fb49f7e71f0e1.png" srcset="/img/loading.gif" lazyload alt="d9ab61eb239f97e8060fb49f7e71f0e1"></p>
<p>hm.db.database:test<br>hm:<br>  db:<br>      database:hm</p>
<p>-&gt;指定参数</p>
<h6 id="2-配置热更新"><a href="#2-配置热更新" class="headerlink" title="2.配置热更新"></a>2.配置热更新</h6><p>例–如我们的购物车上线是10–我们想要通过配置管理-<br>这里也可以用数据库的方法进行控制-但是配置方法更节约资源<br>1.nacos添加配置<br>2.微服务读取配置</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/bb27fd15744a4ce0dbbebcec3c82fded.png" srcset="/img/loading.gif" lazyload alt="bb27fd15744a4ce0dbbebcec3c82fded"></p>
<p>指定配置</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/7bd5b3ef60ef4f21a05d38e55b3c9c97.png" srcset="/img/loading.gif" lazyload alt="7bd5b3ef60ef4f21a05d38e55b3c9c97"></p>
<p>get读取即可</p>
<p>类似心跳检测机制一样的更新</p>
<h6 id="3-动态路由"><a href="#3-动态路由" class="headerlink" title="3.动态路由"></a>3.动态路由</h6><p>动态路由</p>
<p>网关的路由配置全部是在项目启动时由org.springframework.cloud.gateway.route.CompositeRouteDefinitionLocator在项目启动的时候加载，并且一经加载就会缓存到内存中的路由表内（一个Map），不会改变。也不会监听路由变更，所以，我们无法利用上节课学习的配置热更新来实现路由更新。</p>
<p>因此，我们必须<strong>监听Nacos的配置变更</strong>，然后手动把最新的路由更新到路由表中。</p>
<p>1.nacos配置实时更新</p>
<p><a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/sdk.html">https://nacos.io/zh-cn/docs/sdk.html</a></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/247218cd325db9d0990af715191c506f.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">serverAddr:</span> Nacos 服务器的地址，用户需要将 &#123;serverAddr&#125; 替换为实际的 Nacos 服务地址。<br><span class="hljs-symbol">dataId:</span> 配置项的唯一标识符，Nacos 通过 dataId 来标记不同的配置文件。<br><span class="hljs-symbol">group:</span> 配置的组名，Nacos 允许将配置划分为不同的组以便管理，默认为 <span class="hljs-string">&quot;DEFAULT_GROUP&quot;</span>。<br></code></pre></td></tr></table></figure>



<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">这里通过 <span class="hljs-built_in">Properties</span> 对象来存储 <span class="hljs-variable">Nacos</span> 的配置信息。特别是 <span class="hljs-variable">Nacos</span> 服务器地址 <span class="hljs-variable">serverAddr</span>。<br>通过 <span class="hljs-variable">NacosFactory</span><span class="hljs-operator">.</span><span class="hljs-variable">createConfigService</span><span class="hljs-punctuation">(</span><span class="hljs-variable">properties</span><span class="hljs-punctuation">)</span> 创建了一个 <span class="hljs-variable">ConfigService</span> 对象，用于与 <span class="hljs-variable">Nacos</span> 配置中心进行交互。<br></code></pre></td></tr></table></figure>

<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">通过 addListener 方法为指定的 dataId 和 <span class="hljs-keyword">group</span> <span class="hljs-title">添加一个监听器，当该配置有变化时，Nacos</span> 会通知客户端。<br>receiveConfig<span class="hljs-literal">Inf</span>o 方法是监听器的回调函数，当配置发生变化时，该方法会接收到变化的配置信息，并打印出来。<br>getExecutor 方法允许用户自定义线程池执行监听回调任务，返回 null 表示使用 Nacos 内部的默认线程池。<br><br><br>getConfig 方法用于同步获取当前 dataId 和 <span class="hljs-keyword">group</span> <span class="hljs-title">对应的配置内容。</span><br><span class="hljs-title">其中 5000</span> 是超时时间，表示如果在 <span class="hljs-number">5</span> 秒内没有获取到配置内容则会超时。<br><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/0fccbe790ea662f50e4dc78e637dfeb9.png" srcset="/img/loading.gif" lazyload></p>
<p>路由更新接口<img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/eb2704aaff009260682661686d43a863.png" srcset="/img/loading.gif" lazyload alt="eb2704aaff009260682661686d43a863"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/3834ba9c13d5c8765637fa028b2d2540.png" srcset="/img/loading.gif" lazyload alt="3834ba9c13d5c8765637fa028b2d2540"></p>
<p>如上-网关路由的检测-和网关路由的更改已经完毕-接下来就是实例</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/1be7a5e7b5ff63918edfb6a98a4df1e8.png" srcset="/img/loading.gif" lazyload alt="1be7a5e7b5ff63918edfb6a98a4df1e8"></p>
<hr>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/21dbf7eb235492bb336c2ee5a9b1d495.png" srcset="/img/loading.gif" lazyload alt="21dbf7eb235492bb336c2ee5a9b1d495"></p>
<hr>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/9283c00f8a1b26caba5a8ea4a7d47102.png" srcset="/img/loading.gif" lazyload alt="9283c00f8a1b26caba5a8ea4a7d47102"># 微服务02</p>
<p>网关过滤器-全局-和指定-&gt;网关登录鉴权-&gt;</p>
<p>微服务到微服务-&gt;Feing拦截器</p>
<p>naocs-&gt;配置共享 -配置热更新-动态路由</p>
<h2 id="微服务03"><a href="#微服务03" class="headerlink" title="微服务03"></a>微服务03</h2><h4 id="微服务保护"><a href="#微服务保护" class="headerlink" title="微服务保护"></a>微服务保护</h4><p><strong>服务保护方案</strong></p>
<ul>
<li><p>请求限流</p>
</li>
<li><p>隔离和熔断</p>
</li>
<li><p>分布式事务</p>
<ul>
<li><p>初识分布式事务</p>
</li>
<li><p>Seata</p>
</li>
<li><p>知道雪崩问题产生原因及常见解决方案</p>
</li>
<li><p>能使用Sentinel实现服务保护</p>
</li>
<li><p>理解分布式事务产生的原因</p>
</li>
<li><p>能使用Seata解决分布式事务问题</p>
</li>
<li><p>理解AT模式基本原理</p>
</li>
</ul>
</li>
</ul>
<h6 id="1-微服务问题"><a href="#1-微服务问题" class="headerlink" title="1.微服务问题"></a>1.微服务问题</h6><p>级联问题-雪崩问题</p>
<p><strong><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/5adedac41a06aa9d5d23e1c048f9aefc.jpg" srcset="/img/loading.gif" lazyload alt="5adedac41a06aa9d5d23e1c048f9aefc"></strong></p>
<p>请求限流，降低了并发上限；线程隔离，降低了可用资源数量；服务熔断，降低了服务的完整度</p>
<p>都是属于降级处理</p>
<h6 id="2-请求限流"><a href="#2-请求限流" class="headerlink" title="2.请求限流"></a>2.请求限流</h6><p>限制或控制接口访问的并发流量<strong>，避免服务因流量激增而出现故障。</strong></p>
<p>请求限有一个限流器，并发请求，经过限流器就变的平均。</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/aa552325c073f6eb535f3dbda6adf3c2.jpg" srcset="/img/loading.gif" lazyload alt="aa552325c073f6eb535f3dbda6adf3c2"></p>
<h6 id="3-线程隔离"><a href="#3-线程隔离" class="headerlink" title="3.线程隔离"></a>3.线程隔离</h6><p><strong>当一个业务接口响应时间长，而且并发高时，我们可以控制该线程的数量。</strong><br>即便该微服务出现问题。浪费的也只是20线程的资源～这里的20是我们设置的线程数量</p>
<h6 id="4-服务熔断"><a href="#4-服务熔断" class="headerlink" title="4.服务熔断"></a>4.服务熔断</h6><p><strong>线程熔断虽然避免了雪崩问题。但是依然无法解决。浪费资源问题</strong></p>
<ul>
<li>编写服务降级逻辑：就是服务调用失败后的处理逻辑，根据业务场景，可以抛出异常，也可以返回友好提示或默认数据。</li>
<li>异常统计和熔断：统计服务提供方的异常比例，当比例过高表明该接口会影响到其它服务，应该拒绝调用该接口，而是直接走降级逻辑。</li>
</ul>
<p>熔断后写一个心跳机制-如果不超时或者异常 </p>
<p> 让他恢复</p>
<h4 id="Sentinel"><a href="#Sentinel" class="headerlink" title="Sentinel"></a>Sentinel</h4><h6 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h6><p>微服务保护技术</p>
<p>Sentinel是阿里巴巴开源的一款服务保护框架</p>
<p>Sentinel 的使用可以分为两个部分:</p>
<ul>
<li><p>核心库（Jar包）：不依赖任何框架&#x2F;库，能够运行于 Java 8 及以上的版本的运行时环境，同时对 Dubbo &#x2F; Spring Cloud 等框架也有较好的支持。在项目中引入依赖即可实现服务限流、隔离、熔断等功能。</p>
</li>
<li><p>控制台（Dashboard）：Dashboard 主要负责管理推送规则、监控、管理机器信息等。</p>
<p>控制台整合</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://sentinelguard.io/zh-cn/docs/dashboard.html">https://sentinelguard.io/zh-cn/docs/dashboard.html</a></p>
<p>微服务整合Sentinel</p>
<!--sentinel-->
<dependency>
    <groupId>com.alibaba.cloud</groupId> 
    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>
</dependency>

<hr>
<p>spring:<br>  cloud:<br>    sentinel:<br>      transport:<br>        dashboard: localhost：8090</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/f3ec0f2747e58af51ff00c89fad2f637.jpg" srcset="/img/loading.gif" lazyload alt="f3ec0f2747e58af51ff00c89fad2f637"></p>
<h6 id="2-簇点链路"><a href="#2-簇点链路" class="headerlink" title="2.簇点链路"></a>2.簇点链路</h6><p> <strong>簇点链路</strong>，指的是在一次请求中经过的各个资源点，例如一个 SpringMVC 的接口 <code>/carts</code>，这是一个被 Sentinel 监控的资源。在默认情况下，Sentinel 会将请求路径（如 <code>/carts</code>）作为唯一标识来识别和监控资源。但在 RESTful 风格的 API 中，同一路径可能会根据 HTTP 方法执行不同的操作，如查询、删除或修改。例如：</p>
<ul>
<li><code>GET /carts</code> 用于查询购物车</li>
<li><code>POST /carts</code> 用于添加购物车</li>
<li><code>DELETE /carts</code> 用于删除购物车</li>
</ul>
<p>由于默认情况下 Sentinel 不区分 HTTP 方法，这会导致多个不同功能的接口被 Sentinel 认为是同一个资源。如果某个操作发生限流、熔断，其他操作也会受到影响，显然是不合理的。</p>
<p>所以我们可以选择打开Sentinel的请求方式前缀，把请求方式 + 请求路径作为簇点资源名：</p>
<p>spring:<br>  cloud:<br>    sentinel:<br>      transport:<br>        dashboard: localhost:8090<br>      http-method-specify: true # 开启请求方式前缀</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/dd6ad74e5a523414c5fa94e71ce26b44.png" srcset="/img/loading.gif" lazyload alt="dd6ad74e5a523414c5fa94e71ce26b44"></p>
<h6 id="3-请求限流"><a href="#3-请求限流" class="headerlink" title="3.请求限流"></a>3.请求限流</h6><p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/513f93a0c1b54d9cf48340131857d35b.png" srcset="/img/loading.gif" lazyload alt="513f93a0c1b54d9cf48340131857d35b"></p>
<p>QPS &#x3D; 总请求数 &#x2F; 时间（秒）<br>6&#x3D;6&#x2F;1</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/8bea4b790cd4908a3b2c157b54a82324.png" srcset="/img/loading.gif" lazyload alt="8bea4b790cd4908a3b2c157b54a82324"></p>
<h6 id="4-线程隔离"><a href="#4-线程隔离" class="headerlink" title="4.线程隔离"></a>4.线程隔离</h6><p>限流-一旦雪崩还是没能解决<br>对查询商品的FeignClient接口做线程隔离</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/dd258ef0eff928db8ad60a51fa901e21.png" srcset="/img/loading.gif" lazyload alt="dd258ef0eff928db8ad60a51fa901e21"></p>
<hr>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/96bf2d1721a6ad24b4c4c57a0420950e.png" srcset="/img/loading.gif" lazyload alt="96bf2d1721a6ad24b4c4c57a0420950e"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/61c54a305d589adf29b99e9e783df0d8_720.png" srcset="/img/loading.gif" lazyload alt="61c54a305d589adf29b99e9e783df0d8_720"></p>
<p>即便服务有什么问题。该服务能使用的线程数一直是10</p>
<h6 id="5-服务熔断"><a href="#5-服务熔断" class="headerlink" title="5.服务熔断"></a>5.服务熔断</h6><p>服务熔断<br><strong>问题-我们设置了线程熔断和QPS限制-那么被拒绝的服务就会被抛出异常</strong><br><strong>我们应该给一个降级处理</strong><br>2-<br>查询的延迟极高-还是会一直消耗资源-我们可以设置阈值-到达就熔断服务</p>
<p>1.编写降级处理<br>FeignClient编写失败后的降级逻辑<br>1.FallbackClass，无法对远程调用的异常做处理<br>2.：FallbackFactory，可以对远程调用的异常做处理，我们一般选择这种方式</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/56ceaa1b237096af7d548dff22f64079.png" srcset="/img/loading.gif" lazyload alt="56ceaa1b237096af7d548dff22f64079"></p>
<p><strong>ItemClientFallback</strong> 类实现了 <code>FallbackFactory&lt;ItemClient&gt;</code>，当 <code>ItemClient</code> 调用失败时，<code>create()</code> 方法会被调用，并接收一个 <code>Throwable cause</code> 参数，表示引发失败的异常。</p>
<p>该方法为默认实现</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/46c47701adaebf8ecdf3bedffcebfcd2.png" srcset="/img/loading.gif" lazyload alt="46c47701adaebf8ecdf3bedffcebfcd2"></p>
<p>注册为Bean</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/b8be56aab96f78ab8cc6280a940b9654.png" srcset="/img/loading.gif" lazyload alt="b8be56aab96f78ab8cc6280a940b9654"></p>
<p>指定回调</p>
<p>降级之后-我们就设置服务熔断</p>
<p><strong>断路器的工作模式</strong><br>Sentinel中的断路器不仅可以统计某个接口的慢请求比例，还可以统计异常请求比例。<strong>当这些比例超出阈值时，就会熔断该接口，即拦截访问该接口的一切请求，降级处理；当该接口恢复正常时，再放行对于该接口的请求。</strong></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/c41d54b8f48ef781a5719d594365b351.png" srcset="/img/loading.gif" lazyload alt="c41d54b8f48ef781a5719d594365b351"></p>
<hr>
<hr>
<hr>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/7186f713c807cd96f4f0736cfdf33eb9.png" srcset="/img/loading.gif" lazyload alt="7186f713c807cd96f4f0736cfdf33eb9"></p>
<h4 id="微服务事务"><a href="#微服务事务" class="headerlink" title="微服务事务"></a>微服务事务</h4><h6 id="1-微服务事务了解"><a href="#1-微服务事务了解" class="headerlink" title="1.微服务事务了解"></a>1.微服务事务了解</h6><ul>
<li><ul>
<li>在单体应用中，事务是通过数据库的 <strong>ACID</strong> 特性（原子性、一致性、隔离性、持久性）来保证的。然而，在微服务架构中，每个服务都有自己独立的数据源（数据库、缓存等），通常无法再通过传统的本地事务管理工具来保证整体事务的一致性。这时会出现如下问题：<ul>
<li><strong>跨服务的事务一致性</strong>：比如用户下单时，订单服务、库存服务、支付服务需要在不同的数据库中进行操作，如何保证所有服务的数据操作要么全部成功，要么全部回滚？</li>
<li><strong>网络延迟与失败</strong>：微服务间的调用是通过网络进行的，网络的延迟或失败会使事务变得复杂。</li>
<li><strong>独立性与隔离性</strong>：不同的微服务通常需要尽量保持高自治性和松耦合性，但在分布式事务中，需要一定的协调性。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h6 id="2-分布式事务场景"><a href="#2-分布式事务场景" class="headerlink" title="2.分布式事务场景"></a>2.分布式事务场景</h6><p>1,.单服务请求多数据库完成一次事务</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/image-20241001165833626.png" srcset="/img/loading.gif" lazyload alt="image-20241001165833626"></p>
<p>2.多服务请求单数据库完成一次事务</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/image-20241001165844052.png" srcset="/img/loading.gif" lazyload alt="image-20241001165844052"></p>
<p>1、跨服务完成一次事务</p>
<p>2、跨数据源完成一次事务</p>
<h6 id="3-Cap原则"><a href="#3-Cap原则" class="headerlink" title="3.Cap原则"></a>3.Cap原则</h6><p>CAP是 Consistency、Availability、Partition tolerance三个词语的缩写，分别表示一致性、可用性、分区容忍性。</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/image-20241001165924978.png" srcset="/img/loading.gif" lazyload alt="image-20241001165924978"></p>
<p>C<strong>一致性:</strong> 向系统写一个新数据再次读取到的也一定是这个新数据。拿上图举例，请求订单服务下单，订单服务请求库存服务扣减库存，只要下单成功则库存扣减成功。</p>
<p><strong>A可用性：</strong>任何时间都可以访问订单服务和库存服务，系统保证可用。</p>
<p>p<strong>分区容忍性：</strong>也叫分区容错性，分布式系统在部署时服务器可能部署在不同的网络分区，比如上图中订单服务在北京，库存服务在上海，由于处于不同的网络分区如果网络通信异常就会导致节点 之间无法通信，当出现由于网络问题导致节点 之间无法通信，此时仍然是对外提供服务的这叫做满足分区容忍性。</p>
<p><strong>CAP理论要强调在<strong><strong>分布式</strong></strong>系统中C、A、P这三点不能全部满足。</strong></p>
<h6 id="4-CP"><a href="#4-CP" class="headerlink" title="4.CP"></a>4.CP</h6><p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/image-20241001165947190.png" srcset="/img/loading.gif" lazyload alt="image-20241001165947190"></p>
<h6 id="5-Ap"><a href="#5-Ap" class="headerlink" title="5.Ap"></a>5.Ap</h6><p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/image-20241001170026148.png" srcset="/img/loading.gif" lazyload alt="image-20241001170026148"></p>
<h6 id="6-实际场景"><a href="#6-实际场景" class="headerlink" title="6.实际场景"></a>6.实际场景</h6><p>满足CP的要求：</p>
<p><strong>创建订单和优惠券核销要么都成功要么都失败，不能存在一个成功一个失败</strong>，如果要实现CP需要在下单和核销优惠券操作前进行一次预操作，如果预操作成功将优惠券锁定避免在执行事务期间优惠券被其它订单使用。</p>
<p>满足AP的要求：</p>
<p><strong>创建订单和优惠券核销要么都成功要么都失败，可以暂时存在一个成功一个失败，最终要保证数据的一致性</strong>，如果要实现AP，不需要提前锁定资源，在执行事务期间有一个失败则么另一个操作回滚即可，最终实现数据一致性。</p>
<p>基于上边的分析，实现CP更麻烦，实现AP同样满足的需求，本项目优惠券核销操作实现AP。</p>
<p>实现方案</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/image-20241001170311395.png" srcset="/img/loading.gif" lazyload alt="image-20241001170311395"></p>
<h4 id="2-Seata"><a href="#2-Seata" class="headerlink" title="2.Seata"></a>2.Seata</h4><h6 id="0-seata模式"><a href="#0-seata模式" class="headerlink" title="0.seata模式"></a>0.seata模式</h6><p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/image-20241001170352060.png" srcset="/img/loading.gif" lazyload alt="image-20241001170352060"></p>
<h6 id="1-Seata了解"><a href="#1-Seata了解" class="headerlink" title="1.Seata了解"></a>1.Seata了解</h6><p>分布式事务-<strong>各个单个事务直接无法感应对方的失败或者成功</strong><br>事务协调者，与多个分支事务通信，检测每个分支事务的执行状态，保证全局事务下的每一个分支事务同时成功或失败即可。大多数的分布式事务框架都是基于这个理论来实现的。<br><strong>回调检查-或者建立通信协议</strong></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/0c45f4302dfe6ec401b7166531e8d0ee.png" srcset="/img/loading.gif" lazyload alt="0c45f4302dfe6ec401b7166531e8d0ee"></p>
<h6 id="2-Seata部署"><a href="#2-Seata部署" class="headerlink" title="2.Seata部署"></a>2.Seata部署</h6><p>部署TC-DOCKER<br>1.<br><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/13bdfa580099aaad3e6b5b6b3a658b23.png" srcset="/img/loading.gif" lazyload alt="img"><br>2.<br><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/954d7d66dc6aede16d41e72775d344aa_720.png" srcset="/img/loading.gif" lazyload alt="img"><br>3.<br><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/47128070412f9199c201de643d226dfe.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<hr>
<hr>
<p>微服务集成Seata</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/4e467740c6cae0760dfeeec1f185a409.png" srcset="/img/loading.gif" lazyload alt="4e467740c6cae0760dfeeec1f185a409"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/969b0797c9e9111080031504307f449a.png" srcset="/img/loading.gif" lazyload alt="969b0797c9e9111080031504307f449a"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/5a81cb44028665de51944504b72b9d05.png" srcset="/img/loading.gif" lazyload alt="5a81cb44028665de51944504b72b9d05"></p>
<p>seata的客户端在解决分布式事务的时候需要记录一些中间数据，保存在数据库中。因此我们要先准备一个这样的表。<br>将课前资料的seata-at.sql-导入进行事务控制的数据库中</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/661baa4e424fa939c19202b5b66381c0.png" srcset="/img/loading.gif" lazyload alt="661baa4e424fa939c19202b5b66381c0"></p>
<h6 id="3-Seata使用"><a href="#3-Seata使用" class="headerlink" title="3.Seata使用"></a>3.Seata使用</h6><p>@Transactional注解改为Seata提供的@GlobalTransactional</p>
<p>微服务事务</p>
<p><strong>@GlobalTransactional注解就是在标记事务的起点，将来TM就会基于这个方法判断全局事务范围，初始化全局事务。</strong></p>
<h6 id="4-分布式解决方案"><a href="#4-分布式解决方案" class="headerlink" title="4.分布式解决方案"></a>4.分布式解决方案</h6><p><strong>两阶段提交（2PC，Two-Phase Commit）</strong>：</p>
<ul>
<li>在第一阶段（准备阶段），所有涉及事务的服务都会“准备”它们的操作，并告知协调者准备状态。</li>
<li>在第二阶段（提交阶段），如果所有服务都准备成功，则协调者通知所有服务提交事务；否则，所有服务都回滚事务。</li>
<li>缺点：两阶段提交的锁定资源时间较长，可能导致性能问题和死锁。</li>
</ul>
<p><strong>TCC 模型（Try-Confirm-Cancel）</strong>：</p>
<ul>
<li>TCC 模型是一种细化的两阶段提交方案，服务在业务逻辑上实现 <code>Try</code>（准备）、<code>Confirm</code>（确认）、<code>Cancel</code>（取消）三个步骤。</li>
<li>在 <code>Try</code> 阶段，服务会预留资源（例如预扣库存）；在 <code>Confirm</code> 阶段，服务确认资源的操作；在 <code>Cancel</code> 阶段，取消预留操作。</li>
</ul>
<p><strong>基于消息的最终一致性</strong>：</p>
<ul>
<li>使用消息队列来保证跨服务的数据一致性。当事务的一部分成功后，其他微服务通过异步消息更新自己的数据，保证最终一致性。</li>
<li>优点：弱化了实时性，较适合对一致性要求不高的场景。</li>
</ul>
<p><strong>SAGA 模型</strong>：</p>
<ul>
<li>SAGA 是一种分布式事务模式，将每个服务的事务划分为多个小事务，每个小事务有对应的补偿操作。</li>
<li>如果某个小事务失败，已经完成的小事务会通过调用补偿逻辑（如回滚、撤销操作）来恢复到一致状态。</li>
</ul>
<h6 id="5-Xa模式"><a href="#5-Xa模式" class="headerlink" title="5.Xa模式"></a>5.Xa模式</h6><p>A是规范-原理是两阶段提交</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/55c86dd3399de2a54a2a7529aba97425.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>一阶段：</p>
<p>tm告诉TC开启全局事务</p>
<p>tm-调用rm</p>
<ul>
<li>事务协调者TC通知每个事务参与者执行本地事务</li>
<li>rm执行sql</li>
<li>本地事务执行完成后报告事务执行状态给<strong>事务协调者</strong>，此时事务不提交，<strong>继续持有数据库锁</strong></li>
</ul>
<p>二阶段：</p>
<ul>
<li>事务协调者基于一阶段的报告来判断下一步操作</li>
<li>如果一阶段都成功，则通知所有事务参与者，提交事务</li>
<li>如果一阶段任意一个参与者失败，则通知所有事务参与者回滚事务</li>
</ul>
<p>也就是-<strong>事务锁只有等一阶段所有RM执行完毕-等待通知-开启2阶段</strong></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/709e85023e48ff24e13992252e2462ce.png" srcset="/img/loading.gif" lazyload alt="709e85023e48ff24e13992252e2462ce"></p>
<p>优缺点<br>行锁的缺点-优点</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/7db161ff42213ab817db33e83bb099e7.png" srcset="/img/loading.gif" lazyload alt="7db161ff42213ab817db33e83bb099e7"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/eec304cd22421ef584ef0d4365467799_720.png" srcset="/img/loading.gif" lazyload alt="eec304cd22421ef584ef0d4365467799_720"></p>
<h6 id="6-At模式"><a href="#6-At模式" class="headerlink" title="6.At模式"></a>6.At模式</h6><p>AT模式同样是分阶段提交的事务模型，不过缺弥补了XA模型中资源锁定周期过长的缺陷。</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/649c531678978500ca68bd26a8db0c6a_720.png" srcset="/img/loading.gif" lazyload alt="649c531678978500ca68bd26a8db0c6a_720"></p>
<p>取消行锁-改为本地log缓存</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/15c2cee13194b25bd165d5980011e9ed.png" srcset="/img/loading.gif" lazyload alt="15c2cee13194b25bd165d5980011e9ed"></p>
<h2 id="阶段一-每个数据库都直接提交-同时备份一个undo-log"><a href="#阶段一-每个数据库都直接提交-同时备份一个undo-log" class="headerlink" title="阶段一 每个数据库都直接提交-同时备份一个undo-log"></a>阶段一 每个数据库都直接提交-同时备份一个undo-log</h2><p>一旦某个地方出现异常-RM回滚-同时TC-检测-分发没个事务进行回滚</p>
<p>流程</p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/88b2c6ae733ee58267bce34f201a1f25.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/05e2129219408c89e3e555605e1ff6cd.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/0c8c093537f83c8d013dc24d35de1ca5.png" srcset="/img/loading.gif" lazyload alt="0c8c093537f83c8d013dc24d35de1ca5"></p>
<p>AT模式下分支事务会立即提交，虽然回滚可以通过快照恢复原始数据，但在异常发生之前，其他事务读取的数据可能是已经修改但未最终确定的状态。因此，若需要保证严格的数据一致性，可能需要结合隔离级别控制和快照机制，或者对已读数据的后续处理进行特殊设计。</p>
<h6 id="Xa-At区别"><a href="#Xa-At区别" class="headerlink" title="Xa At区别"></a>Xa At区别</h6><p><img src="https://raw.githubusercontent.com/Xlan-cell/tupian/master/e527cdc2f3f935ead60411649086b841.png" srcset="/img/loading.gif" lazyload alt="e527cdc2f3f935ead60411649086b841"></p>
<p>tm-&gt;告知TC开启事务<br>RM执行sql-并且保存sql快照-&gt;提交</p>
<p>事务介绍-&gt;tm告知-&gt;tc结束</p>
<p>tc检查是否有异常-无异常提交-有异常回档</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/spring/" class="category-chain-item">spring</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>微服务Spring Cloude</div>
      <div>http://example.com/2024/09/20/微服务01/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年9月20日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/09/21/Dr%E6%A0%A1%E5%9B%AD%E7%BD%91%E8%BF%87%E6%BB%A4%E8%B8%A2%E5%87%BA/" title="Dr自动踢人">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Dr自动踢人</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/09/19/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%BA%BF%E6%80%A7%E8%A1%A8-%E9%93%BE%E8%A1%A8/" title="数据结构-线性表-单链表02">
                        <span class="hidden-mobile">数据结构-线性表-单链表02</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createCssLink('https://registry.npmmirror.com/@waline/client/2.15.8/files/dist/waline.css')
      Fluid.utils.createScript('https://registry.npmmirror.com/@waline/client/2.15.8/files/dist/waline.js', function() {
        var options = Object.assign(
          {"serverURL":"https://abc.nixgou.cn/","path":"window.location.pathname","meta":["nick"],"requiredMeta":["nick"],"lang":"zh-CN","emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],"dark":"html[data-user-color-scheme=\"dark\"]","wordLimit":0,"pageSize":10},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        Waline.init(options);
        Fluid.utils.waitElementVisible('#waline .vcontent', () => {
          var imgSelector = '#waline .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
